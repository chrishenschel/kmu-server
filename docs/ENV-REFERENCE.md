# Environment variable reference

All variables used by `docker-compose.yaml` and the setup/backup scripts. **Do not commit `.env`**; it contains secrets. Use [.env.example](../.env.example) as a template.

## Root `.env` (repo root)

Generated by `02-system-setup.sh` or set manually. Required for `docker compose up`.

### Domain and admin user

| Variable | Set by | Description |
|----------|--------|-------------|
| `DOMAIN` | Setup / you | Base domain, e.g. `example.com`. Used in Caddyfile, blueprints, Nextcloud, Jitsi, Immich, Vaultwarden. |
| `USERNAME` | Setup / you | Initial admin username (Authentik, Nextcloud admin, Stalwart mailbox). |
| `USERFULLNAME` | Setup / you | Full name for the initial user. |
| `PASSWORD` | Setup / you | Password for initial admin (Authentik, Nextcloud, Stalwart). Keep safe. |

### PostgreSQL

| Variable | Set by | Description |
|----------|--------|-------------|
| `PG_PASS` | Setup | Password for PostgreSQL superuser `postgres`. Used by Authentik, Synapse, Stalwart, Nextcloud, Immich. |

### Authentik

| Variable | Set by | Description |
|----------|--------|-------------|
| `AUTHENTIK_SECRET_KEY` | Setup | Secret key for Authentik (sessions, crypto). |
| `AUTHENTIK_BOOTSTRAP_PASSWORD` | Setup | Bootstrap admin password (skip setup wizard). |
| `AUTHENTIK_BOOTSTRAP_TOKEN` | Setup | API token for bootstrap/automation (e.g. user-sync, admin-panel). |
| `AUTHENTIK_BOOTSTRAP_EMAIL` | Setup | Bootstrap admin email (e.g. `hostmaster@domain`). |

### LDAP (Stalwart)

| Variable | Set by | Description |
|----------|--------|-------------|
| `LDAP_BASE_DN` | Setup | LDAP base DN, e.g. `dc=example,dc=com`. |
| `LDAP_OUTPOST_TOKEN` | Setup | Token for Authentik LDAP outpost. Written by setup after blueprints apply. |

### OAuth / OIDC client credentials

Used in Authentik blueprints and applications. Setup generates random values and writes them here and into blueprint/config files.

| Variable | Set by | Used by |
|----------|--------|---------|
| `MATRIX_CLIENT_ID`, `MATRIX_CLIENT_SECRET` | Setup | Synapse (Matrix) OIDC provider in Authentik. |
| `NC_CLIENT_ID`, `NC_CLIENT_SECRET` | Setup | Nextcloud OIDC provider. |
| `VW_CLIENT_ID`, `VW_CLIENT_SECRET` | Setup | Vaultwarden SSO (Authentik). |
| `IMMICH_CLIENT_ID`, `IMMICH_CLIENT_SECRET` | Setup | Immich OAuth (Authentik + `immich/immich.json`). |

### Nextcloud mail

| Variable | Set by | Description |
|----------|--------|-------------|
| `NOREPLY_EMAIL` | Setup | Sender for Nextcloud system mail (e.g. `noreply@example.com`). |
| `NOREPLY_MAIL_PASSWORD` | Setup | Password for `noreply@â€¦` mailbox in Stalwart. |

### Jitsi Meet

| Variable | Set by | Description |
|----------|--------|-------------|
| `JWT_APP_ID` | Setup | Jitsi JWT app id (e.g. `jitsi`). |
| `JWT_APP_SECRET` | Setup | Jitsi JWT secret; must match meet-sso. |
| `MEET_DOMAIN` | Setup | Public Meet hostname (e.g. `meet.example.com`). |

### Optional overrides

| Variable | Default | Description |
|----------|---------|-------------|
| `VW_SIGNUPS_ALLOWED` | `true` | Allow new Vaultwarden signups. |
| `VW_SSO_ONLY` | `false` | If `true`, disable email/password login in Vaultwarden (SSO only). |
| `RESTART_POLICY` | `unless-stopped` | Docker restart policy for Jitsi stack. |
| `JITSI_IMAGE_VERSION` | `stable` | Jitsi image tag. |
| `CONFIG` | `./jitsi/config` | Host path for Jitsi config (used in compose). |

## Jitsi (`jitsi/.env.meet`)

Patched by `02-system-setup.sh`. Contains XMPP passwords, TURN credentials, public URL, etc. See [Jitsi docs](https://jitsi.github.io/handbook/) for full list. Do not commit this file if it contains real secrets.

## Immich (`immich/immich.json`)

OAuth and server URL. Placeholders `__DOMAIN__`, `__IMMICH_CLIENT_ID__`, `__IMMICH_CLIENT_SECRET__` are replaced by setup. Backed up by `backup.sh`.

## Losing `.env`

If you lose `.env` and have no backup:

- You must recreate all secrets and re-patch blueprints/config (domain, client ids/secrets).
- Restore from a backup snapshot that includes the `env` file (see [Backup & restore](../README.md#12-backup--restore)), or re-run `02-system-setup.sh` on a **new** installation (script overwrites/appends; not safe to blindly re-run on production without reading it).
