[server.listener.smtp]
bind = "[::]:25"
protocol = "smtp"

[server.listener.submission]
bind = "[::]:587"
protocol = "smtp"

[server.listener.submissions]
bind = "[::]:465"
protocol = "smtp"
tls.implicit = true

[server.listener.imap]
bind = "[::]:143"
protocol = "imap"

[server.listener.imaptls]
bind = "[::]:993"
protocol = "imap"
tls.implicit = true

[server.listener.pop3]
bind = "[::]:110"
protocol = "pop3"

[server.listener.pop3s]
bind = "[::]:995"
protocol = "pop3"
tls.implicit = true

[server.listener.sieve]
bind = "[::]:4190"
protocol = "managesieve"

[server.listener.https]
protocol = "http"
bind = "[::]:443"
tls.implicit = true

[server.listener.http]
bind = [ "0.0.0.0:8080" ]
protocol = "http"
url = "https://mail.__DOMAIN__"
use-proxy-headers = true

[storage]
data = "postgres"      # Store metadata (folders, flags, tags) in SQL
directory = "postgres" # Store user accounts in SQL
blob = "fs"            # Store actual email bodies as files on disk
fts = "rocksdb"        # Keep Search Index in RocksDB (it is fast and disposable)
lookup = "rocksdb"     # Keep temporary lookups fast in RocksDB

# Define the Postgres connection
[store.postgres]
type = "sql"
url = "postgres://postgres:__PG_PASS__@postgres:5432/stalwart"

# Define the File System connection for Blobs
[store.fs]
type = "fs"
path = "/opt/stalwart-mail/data/blobs" # This path is inside the container

[store.rocksdb]
type = "rocksdb"
path = "/opt/stalwart/data"
compression = "lz4"

[directory.internal]
type = "internal"
store = "rocksdb"

[tracer.log]
type = "log"
level = "info"
path = "/opt/stalwart/logs"
prefix = "stalwart.log"
rotate = "daily"
ansi = false
enable = true

[session]
# Add "oidc" to the list. "plain" is kept for standard IMAP/SMTP clients.
auth-mechanisms = ["plain", "oidc"]

[directory.authentik]
type = "oidc"
timeout = "15s"
client-id = "__CLIENT_ID__"
client-secret = "__CLIENT_SECRET__"
issuer-url = "https://auth.__DOMAIN__/application/o/stalwart-mail/"
create-not-found = true

[directory.authentik.fields]
username = "preferred_username"
email = "email"
full-name = "name"
