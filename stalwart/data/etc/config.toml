[server]
hostname = "mail.__DOMAIN__"

[server.listener.smtp]
bind = "[::]:25"
protocol = "smtp"

[server.listener.smtps]
bind = "[::]:465"
protocol = "smtp"
tls.implicit = true

[server.listener.imaps]
bind = "[::]:993"
protocol = "imap"
tls.implicit = true

[server.listener.http]
bind = ["0.0.0.0:8080"]
protocol = "http"
url = "https://mail.__DOMAIN__"
use-proxy-headers = true

[certificate.default]
cert = "/opt/stalwart/caddy-data/caddy/certificates/acme-v02.api.letsencrypt.org-directory/mail.__DOMAIN__/mail.__DOMAIN__.crt"
private-key = "/opt/stalwart/caddy-data/caddy/certificates/acme-v02.api.letsencrypt.org-directory/mail.__DOMAIN__/mail.__DOMAIN__.key"

[storage]
data = "postgres"
directory = "authentik"
blob = "fs"
fts = "rocksdb"
lookup = "rocksdb"

[store.postgres]
type = "postgresql"
host = "postgres"
port = 5432
database = "stalwart"
user = "postgres"
password = "__PG_PASS__"

[store.fs]
type = "fs"
path = "/opt/stalwart/blobs"

[store.rocksdb]
type = "rocksdb"
path = "/opt/stalwart/data"
compression = "lz4"

[directory.authentik]
type = "ldap"
url = "ldap://authentik-ldap:3389"
base-dn = "__LDAP_BASE_DN__"
timeout = "30s"

[directory.authentik.bind]
dn = "cn=__BIND_USER__,ou=users,__LDAP_BASE_DN__"
secret = "__BIND_PASSWORD__"

[directory.authentik.bind.auth]
method = "lookup"

[directory.authentik.filter]
name = "(cn=?)"
email = "(mail=?)"

[directory.authentik.attributes]
name = "cn"
class = "objectClass"
email = "mail"
groups = ["memberOf"]
secret-changed = "mail"

[tracer.log]
type = "log"
level = "info"
path = "/opt/stalwart/logs"
prefix = "stalwart.log"
rotate = "daily"
ansi = false
enable = true

[tracer.stdout]
type = "stdout"
level = "info"
ansi = true
enable = true

[authentication.fallback-admin]
user = "admin"
secret = "__BIND_PASSWORD__"

[session]
auth-mechanisms = ["plain"]
